# users table
INSERT INTO users(email, master_pwd) VALUES  (
    ${email}, crypt(${mpwd}, gen_salt('md5'))
);

SELECT * FROM users WHERE 
    email=${email}, 
    master_pwd=crypt(${mpwd}, master_pwd);

# passwords table
INSERT INTO passwords(site, user_id, username, password) VALUES (
    ${site}, ${user_id}, ${username}, pgp_sym_encrypt(${pwd}, ${master_pwd})
)

SELECT username, pgp_sym_decrypt(pwd::bytea, ${mpwd}) as pwd 
    FROM passwords
    WHERE user_id=${user_id} AND site=${site}

# Sample master pwd hash
$1$OZRo/Do2$3y31l.hgQLJ.ZVOkwxbuR1



